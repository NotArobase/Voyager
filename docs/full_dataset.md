# Documentation of Andromeda dataset

This file accompanies the Andromeda dataset, and provides an overview and description of the entities and their attributes stored within it.

## GalaxyMetadata
This part of the dataset contains metadata harvested from the [Ansible Galaxy](https://galaxy.ansible.com/) ecosystem.
It consists of 7 core entity types.
An `index.yaml` file is provided, which maps the name of the entity type to the file containing all entries.
All separate files are key-value mappings, mapping Galaxy's internal ID to the entity it corresponds to.
Cross-references in these files are stored as `EntityType:EntityID`, e.g., `Role:123` points to the `Role` entity with ID 123.
Note that user information is not provided in this dataset, since it contains personal information, although numerical user IDs are retained in cross-references.

### CommunitySurveys
The `CommunitySurveys.yaml` file contains all quality surveys submitted by Galaxy community members.
Attributes:
- `entity_id`: The numerical ID of the survey on Galaxy.
- `reviewer_user_id`: A cross-reference ID to the user that created this review.
- `reviewed_repository`: A cross-reference ID to the reviewed repository.
- `score_documentation`: Integer value (0-5), score for "Quality of docs?" question. May be null if unanswered.
- `score_does_what_it_says`: Integer value (0-5), score for "Does what it promises?" question. May be null if unanswered.
- `score_ease_of_use`: Integer value (0-5), score for "Ease of use?" question. May be null if unanswered.
- `score_used_in_production`: Integer value (0-5), score for "Ready for production?" question. May be null if unanswered.
- `score_works_as_is`: Integer value (0-5), score for "Works without change?" question. May be null if unanswered.
- `creation_date`, `modification_date`: RFC 3339 string containing creation and last modification dates of the entity on Galaxy.

### Content
The `Content.yaml` file contains the individual pieces of content listed on Galaxy.
Attributes:
- `entity_id`: The numerical ID of the content on Galaxy.
- `content_type`: The type of content. Possible values: `role`, `filter`, `module`, `callback`, `strategy`, `apb` (Ansible Playbook Bundle), `lookup`, `module_utils`, `action`, `inventory`. See also [the documentation on content types](https://galaxy.ansible.com/docs/finding/content_types.html).
- `role_type`: For content of type `role`, this contains the type of role. Possible values are
    - `ANS` -- A "normal" Ansible role
    - `APP` -- Demo applications?
    - `CON` -- A role for use with [`ansible-container`](https://github.com/ansible/ansible-container).
- `creation_date`, `modification_date`: RFC 3339 string containing creation and last modification dates of the entity on Galaxy.
- `import_date`: RFC 3339 string containing the date this content was last imported, if available. May be `null`.
- `name`, `original_name`: The name of the role and its original name. The difference between the two is that Galaxy will automatically remove prefixes such as "ansible-role-" from the original name, i.e., `ansible-role-xxx` becomes `xxx`
- `description`: String description of the content, may be `null`.
- `download_count`: The number of times this content was downloaded.
- `score_content`, `score_quality`, `score_metadata`: Quality scores generated by linters and community members, float (0-1), may be `null`.
- `score_messages`: A list of messages generated while linting the content. Sub-attributes:
    + `entity_id`: Numerical ID of this message.
    + `is_linter_rule_violation`: Whether this message is generated from a violation of a linter.
    + `linter_rule_id`: The rule ID of the linter
    + `linter_type`: The linter that generated the message.
    + `message_text`, `message_type`: Type and text of the generated message.
    + `rule_description`, `rule_severity`: Information about the linter rule.
    + `score_type`: Which part of the content score is affected by this message, e.g. "metadata".
- `namespace_id`, `repository_id`: Cross-references to the namespace and repository this content belongs to.
- `dependencies`: A list of dependencies of this content, as their canonical ID.

### Namespaces
The `Namespaces.yaml` file contains the Galaxy namespaces, which group content.
Attributes:
- `entity_id`: Numerical ID on Galaxy.
- `is_active`: Whether the namespace is active or deactivated by an owner.
- `name`: The namespace's name.
- `description`: Description of the namespace, or `null`.
- `homepage_url`: A URL to the homepage of the namespace, or `null`.
- `content_counts`: A mapping from content type to the number of entries in this namespace for that content. Content types with 0 entries are not included.
- `owner_ids`: List of user IDs of the namespace owners.
- `provider_namespace_ids`: List of provider namespace IDs that are included into this namespace.
- `creation_date`, `modification_date`: RFC 3339 string containing creation and last modification dates of the entity on Galaxy.

### Provider Namespaces
The `ProviderNamespaces.yaml` file contains provider namespaces known to Galaxy. These are similar to Namespaces, but correspond to users or organisations on GitHub.
Attributes:
- `entity_id`: Numerical ID on Galaxy.
- `name`: Name of the provider namespace.
- `description`: Description of the provider namespace, or `null`.
- `homepage_url`: A URL to the homepage of the provider namespace, or `null`.
- `follower_count`: The number of followers this provider namespace has.
- `namespace_id`: Cross-reference to the namespace this provider namespace belongs to. May be `null` in some circumstances.
- `creation_date`, `modification_date`: RFC 3339 string containing creation and last modification dates of the entity on Galaxy.


### Repository
The `Repositories.yaml` file contains repositories known to Galaxy.
Attributes:
- `entity_id`: Numerical ID on Galaxy.
- `name`, `original_name`: Name of the repo. The difference to the original name is similar to Content.
- `description`: Description of the repository, if available.
- `readme`: Content of the README of the repository when it was last imported, if available.
- `commit_sha`, `commit_creation_date`, `commit_message`: Information on the latest commit when the repo was last imported, if available.
- `is_deprecated`, `is_enabled`: Whether the repo is deprecated or disabled.
- `format`: The format of the repository, similar to content type in Content.
- `download_url`: URL for the latest download of the repository.
- `github_url`: GitHub URL to the repo.
- `import_branch`: The branch that is to be imported on Galaxy.
- `travis_ci_build_url`, `travis_ci_status_badge_url`: URLs to Travis CI information, if available.
- `versions`: List of versions for this repository. This is a list of dictionaries, which further contain the version name and the download URL.
- `download_count`, `stargazers_count`, `watchers_count`, `forks_count`, `open_issues_count`: Counters.
- `community_survey_score`: Aggregate score of all community surveys. `null` if there are none.
- `community_surveys`: Cross-references to the community surveys.
- `quality_score`, `latest_quality_score_date`: Similar to content scores in Content.
- `content_counts`: The counts of content available in this repo, similar to namespaces.
- `content_ids`: Cross-references to the content in this repo.
- `provider_namespace_id`: Cross-reference to the provider namespace this repo belongs to.
- `namespace_id`: Cross-reference to the namespace this repo belongs to, if available.
- `last_import_{created_date, modified_date, started_date, finished_date, status}`: Information and timestamps about the last time the repo was imported, if available.
- `creation_date`, `modification_date`: RFC 3339 string containing creation and last modification dates of the entity on Galaxy.

### Roles
`Roles.yaml` contains all roles known to Galaxy, which are a specific type of content.
Attributes:
- `entity_id`: Numerical ID on Galaxy.
- `canonical_id`: The role's canonical ID, used e.g. in `ansible-galaxy install` commands. Constructed as `<namespace name>.<role name>`.
- `name`: Role's name.
- `username`: Username of the role's owner, if available.
- `description`: Description of role, if available.
- `is_valid`: Whether this role is valid (valid format?)
- `license`: The role's license.
- `min_ansible_version`: Version string of the minimum Ansible version required to use this role.
- `role_type`: See `Content.content_type`
- `dependencies`: List of dependencies, using canonical IDs.
- `supported_platforms`: List of platforms this role supports. They each have the following attributes:
    + `name`: The name of the platform
    + `version`: The platform's version
- `download_count`, `download_rank`: The number of times the role was downloaded, and a ranking
- `tags`: List of tags for the role.
- `versions`: List of versions known to Galaxy. They each have the following attributes:
    + `entity_id`: The ID of the version.
    + `version`: String of the version number.
    + `release_date`: RFC 3339 date representation of when the version was released.
- `commit_sha`, `commit_message`: Information on the latest commit to the role.
- `namespace_id`, `provier_namespace_id`, `repository_id`: Cross-references to other entities.
- `creation_date`, `modification_date`: RFC 3339 string containing creation and last modification dates of the entity on Galaxy.
- `imported_date`: When the role was last imported, may be `null`.

### Tags
`Tags.yaml` contains all tags known to Galaxy.
These are not linked to other entities, but their name can be linked to the roles `tags` field.
Attributes:
- `entity_id`: Numerical ID
- `name`: The name of the tag
- `creation_date`, `modification_date`: RFC 3339 string containing creation and last modification dates of the entity on Galaxy.



## RepositoryMetadata
This part of the dataset contains metadata harvested from the git repositories in Galaxy.
This metadata is harvested from the git repositories themselves.
They include git commits and git tags.
The directory structure is as follows: The `RepositoryMetadata` directory contains subdirectories per GitHub repo owner.
Each subdirectory contains a file for each repository, which in turn contains the metadata.
The `index.yaml` file maps Galaxy repository IDs to the actual file.
In each file, the following attributes are defined:
- `commits`: The list of commits to this repository, in the order in which they appear. The first entry is the latest commit, the last entry is the first commit. Each commit has the following attributes:
    + `author_email`, `author_name`: SHA1 hash of the name and email address of the commit author.
    + `committer_email`, `committer_name`: SHA1 hash of the name and email address of the committer.
    + `authored_datetime`, `committed_datetime`: RFC 3339 string representing the date the commit was authored and committed.
    + `commit_message`: The commit message
    + `sha1`: The SHA1 hash of the commit.
- `tags`: List of tags on the repo, with following attributes (some of these may be `null` in case of lightweight tags):
    + `message`: The tag message, if defined.
    + `name`: The tag name
    + `tagged_datetime`: RFC 3339 timestamp of when the tag was created
    + `tagger_name`, `tagger_email`: SHA1 hash of tagger name and email address.
    + `commit_sha1`: The commit this tag points to.



## StructuralModels
The `StructuralModels` part of the dataset contains structural models extracted from role versions.
It contains one file per role, named after the role's canonical ID.
Each file contains a list of role versions and their structural model.
The following attributes are defined on each entry:
- `role_id`: The role's canonical ID (same as file name)
- `role_rev`: The revision of the role, i.e. the tag name or `HEAD` indicating the latest commit
- `role_root`: The root of the structural model.

The structural model in `role_root` contains the following attributes:
- `broken_files`: A list of files that could not be converted:
    + `path`: The path to the file in the repo
    + `reason`: Why it couldn't be converted
- `logs`: Any log messages outputted by Ansible's internal parser
- `meta_file`: Structural representation of the metadata file
    + `file_name`: Always `main/meta.yml`
    + `metablock`: The actual metadata
        * `galaxy_info`: dictionary of the `galaxy_info` field in the metadata
        * `platforms`: List of platforms in the metadata
        * `dependencies`: canonical role ID dependencies
- `role_var_files` and `default_var_files`: Files containing role and default variables, respectively.
    + `file_name`: The name of the file
    + `content`: Key-value mapping of variable names to their values
- `task_files`, `handler_files`: List of files containing tasks and handlers, respectively.
    + `file_name`: Name of the file
    + `content`: List of blocks in the file
        * Attributes except for `block`, `rescue`, and `always` represent the keywords on the block. See also [the Ansible docs](https://docs.ansible.com/ansible/latest/reference_appendices/playbooks_keywords.html#block)
        * Attributes `block`, `rescue`, `always` contain a list of tasks and/or sub-blocks in the respective portions of the block.
            - Tasks are a mapping of keywords to their values. See also [the Ansible docs](https://docs.ansible.com/ansible/latest/reference_appendices/playbooks_keywords.html#task)
            - Although `action` and `args` aren't represented literally in the source code, they are represented as separate keywords in the Task. E.g.,
                ```yaml
                - name: A task
                  apt:
                    name: mysql
                    state: present
                ```
            is represented as
                ```yaml
                - name: A task
                  action: apt
                  args:
                    name: mysql
                    state: present
                ```
            For actions without separate arguments, e.g. `include_tasks`, the arguments are similar, but named `_raw_params`:
                ```yaml
                - include_tasks: Debian.yml
                ```
            becomes
                ```yaml
                - action: include_tasks
                  args:
                    _raw_params: Debian.yml
                ```
            - Deprecated keywords are replaced by their modern equivalents, if possible. E.g.,
                ```yaml
                - name: a task
                  with_items: "{{ data_to_loop_over }}"
                ```
            becomes
                ```yaml
                - name: a task
                  loop: "{{ data_to_loop_over }}"
                ```

Note that for tasks and blocks, keywords which aren't defined in the source code, aren't included in the structural model either, to distinguish between keywords that aren't defined and keywords which are defined, but happen to have values that are equal to the defaults.


## StructuralRoleEvolution
The final part of the dataset, in `StructuralRoleEvolution`, contain structural differences extracted between role versions.
The files are named identically to the ones in `StructuralModels`.
Each file contains the following attributes
- `role_id`: Same as file name
- `diff_sets`: Sets of changes between versions.

Each change set in `diff_sets` contains the following attributes
- `new_rev`: The revision of the new version of the structural model
- `old_rev`: The revision of the old version of the structural model
- `diffs`: The changes distilled between both versions.

Each change has at least the following attributes:
- `diff_type`: The type of change.
- `object_id`: The location of the object to which the change applies, e.g.
    + `tasks/main.yml[0].block[2]` points to the 3rd task in the block portion of the 1st block of the `tasks/main.yml` file.
    + `vars/main.yml:nginx_user` points to the `nginx_user` variable in the `vars/main.yml` file.
- In addition, each change type has the following attributes:
    + Additions (`*Addition`): `added_value` contains the object that was added
    + Removals (`*Removal`): `removed_value` contains the object that was removed
    + Edits (`*Edit`): `old_value` and `new_value` contain the values in the old and new revision, respectively
    + Relocations (`*Relocation`): `old_location` and `new_location` contain the old and new location of the object, respectively. `old_location` is identical to `object_id`.

The following change types are defined:
- `{DefaultVariable, RoleVariable}{Addition, Removal}`: The addition/removal of a default or role variable.
- `{DefaultVariable, RoleVariable}Edit`: A change to the value of a default or role variable.
- `{DefaultVariable, RoleVariable}Relocation`: The relocation of a variable to a different variable file. **NOTE:** Relocations within the file (reordering the variable list) is not extracted as a change, since the order of variables makes no semantic difference.
- `{Task,HandlerTask}{Addition, Removal}`: Addition/removal of a task or handler task.
- `{Task,HandlerTask}Edit`: Change to the keywords of a task or handler task.
- `{Task,HandlerTask}Relocation`: Relocation (either within the block, or to a different block) of a task or handler.
- `{Block,HandlerBlock}{Addition,Removal}`: Addition/removal of a block or handler block. **NOTE:** Additions or removals of tasks in these blocks are represented separately. They may also have been relocated to this block.
- `{Block,HandlerBlock}Edit`: Edits to the keywords of the block. **NOTE:** Edits/additions/removals to the task/sub-block lists (`block:`,  `rescue:`, `always:`) are not included in these edits, and are instead represented as separate changes.
- `{Block,HandlerBlock}Relocation`: Relocations of blocks or handler blocks, either within the parent or to a different parent.
- `{TaskFile,HandlerFile,DefaultVarFile,RoleVarFile}{Addition,Removal}`: Additions/removals of file types. **NOTE:** This is just about the files, changes to their content are represented separately.
- `{TaskFile,HandlerFile,DefaultVarFile,RoleVarFile}Relocation`: File renamings.
- `{Platform,Dependency}{Addition,Removal}`: Additions or removals of platforms or dependencies in the metadata.
- `{MetaEdit}`: Other edits to the metadata not represented by edits to platforms or dependencies.
